{% extends "_base.html" %}
{% block title %}{{ project.name }}{% endblock %}
{% block header %}
  {{ project.name }}
  {% if current_user.is_authenticated() %}
    <span class="btn-group pull-right">
      {{ header_button('editor-mode-edit', '/projects/%s/edit' % project.slug) }}
      {{ header_button('av-play-circle-outline', '/projects/%s/jobs/new' % project.slug) }}
    </span>
  {% endif %}
{% endblock %}
{% block content %}
<div class="checkbox"><label>
  <input id="filterStable" type="checkbox" {{ 'checked' if versioned else '' }}>Only stable releases
</label></div>
<table id="jobs-list" class="table table-striped">
  <tr><th>Created</th><th>Tag</th><th>Commit ref</th><th>Author</th><th>State</th></tr>
  {% for job in jobs -%}
    <tr class="job-detail">
      <td><a href="/projects/{{ project.slug }}/jobs/{{ job.slug }}">{{ job.create_ts }}</a></td>
      <td>{{ job.tag if job.tag else '' }}</td>
      <td>{{ job.commit }}</td>
      <td>{{ git_user(job.git_author_name, job.git_author_email) if job.git_author_name or job.git_author_email else ''}}</td>
      <td>{{ job_state_glyph(job.state) }}</td>
    </tr>
  {%- endfor %}
</table>
{% set versioned_str = '&versioned' if versioned else '' %}
{% if prev_page_offset is not none -%}
    <a href="{{ '/projects/%s?page_offset=%d&page_size=%d%s' % (project.slug, prev_page_offset, page_size, versioned_str) }}" class="pagination btn btn-default btn-lg">Previous</a>
{% endif -%}
{% if next_page_offset is not none -%}
    <a href="{{ '/projects/%s?page_offset=%d&page_size=%d%s' % (project.slug, next_page_offset, page_size, versioned_str) }}" class="pagination btn btn-default btn-lg pull-right">Next</a>
{% endif -%}
<script>
  $(document).ready(function() {
    $('#filterStable').change(function(ev) {
      if (ev.target.checked) {
        document.location = URI(document.location)
          .addQuery('versioned')
          .removeQuery('page_offset')
          .toString();
      } else {
        document.location = URI(document.location)
          .removeQuery('versioned')
          .removeQuery('page_offset')
          .toString();
      }
    })
  })
</script>
{% endblock %}
