{% extends "_base.html" %}
{% block title %}{{ project.name }}{% endblock %}
{% block header %}
  {{ project.name }}
  {% if current_user.is_authenticated() %}
    <span class="btn-group pull-right">
      {{ header_button('action-delete', '#', 'btn-danger btn-flat', 'data-toggle="modal" data-target="#delete-dialog"') }}
      {{ header_button('editor-mode-edit', '/projects/%s/edit' % project.slug) }}
      {{ header_button('av-play-circle-outline', '/projects/%s/jobs/new' % project.slug) }}
    </span>
  {% endif %}
{% endblock %}
{% block content %}
<style type="text/css">
  .jobs-list-git-branch {
    overflow: hidden;
  }
</style>
<span class="pull-right">{{ project_shield(project) }}</span>
<div class="checkbox col-sm-5" style="margin-top: 0px"><label>
  <input id="filterStable" type="checkbox" {{ 'checked' if versioned else '' }}>Only stable releases
</label></div>
{% if current_user.is_authenticated() %}
  <div id="delete-dialog" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
          <h4 class="modal-title">Really delete {{ project.name }}?</h4>
        </div>
        <div class="modal-body">
          <p>This will delete all job logs, artifacts, and GitHub hooks but not
             any Docker images or containers.</p>
        </div>
        <div class="modal-footer">
          <form action="{{ url_for('project_view', slug=project.slug) }}" method="POST">
            <input type="hidden" name="operation" value="delete" />
            <input type="hidden" name="auth_token" value="{{ auth_token_delete.auth_token }}" />
            <input type="hidden" name="expiry" value="{{ auth_token_delete.expiry }}" />

            <button class="btn" data-dismiss="modal">Cancel</button>
            <input type="submit" class="btn btn-danger" value="Delete" />
          </form>
        </div>
      </div>
    </div>
  </div>
{% endif %}
<table id="jobs-list" class="table table-striped">
  <tr>
    <th class="jobs-list-create-ts">Created</th>
    <th class="jobs-list-git-branch">Branch</th>
    <th class="jobs-list-tag">Tag</th>
    <th class="jobs-list-commit">Commit ref</th>
    <th class="jobs-list-author">Author</th>
    <th class="jobs-list-state">State</th>
  </tr>
  {% for job in jobs -%}
    <tr class="job-detail">
      <td class="jobs-list-create-ts"><a href="/projects/{{ project.slug }}/jobs/{{ job.slug }}">{{ job.create_ts }}</a></td>
      <td class="jobs-list-git-branch">{{ job.git_branch if job.git_branch else '' }}</td>
      <td class="jobs-list-tag">{{ job.tag if job.tag else '' }}</td>
      <td class="jobs-list-commit">{{ job.commit }}</td>
      <td class="jobs-list-author">{{ git_user(job.git_author_name, job.git_author_email) if job.git_author_name or job.git_author_email else ''}}</td>
      <td class="jobs-list-state">{{ job_state_glyph(job.state) }}</td>
    </tr>
  {%- endfor %}
</table>
{% set versioned_str = '&versioned' if versioned else '' %}
{% if prev_page_offset is not none -%}
    <a href="{{ '/projects/%s?page_offset=%d&page_size=%d%s' % (project.slug, prev_page_offset, page_size, versioned_str) }}" class="pagination btn btn-default btn-lg">Previous</a>
{% endif -%}
{% if next_page_offset is not none -%}
    <a href="{{ '/projects/%s?page_offset=%d&page_size=%d%s' % (project.slug, next_page_offset, page_size, versioned_str) }}" class="pagination btn btn-default btn-lg pull-right">Next</a>
{% endif -%}
<script>
  $(document).ready(function() {
    $('#filterStable').change(function(ev) {
      if (ev.target.checked) {
        document.location = URI(document.location)
          .addQuery('versioned')
          .removeQuery('page_offset')
          .toString();
      } else {
        document.location = URI(document.location)
          .removeQuery('versioned')
          .removeQuery('page_offset')
          .toString();
      }
    })
  })
</script>
{% endblock %}
